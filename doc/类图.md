# 类设计

```c++
struct element {

    element();   // 初始化各个参数为0
    float x;
    float y;
    float c_i; // 压力系数 (0, 1)
    float p_i; // 压力 (0, 1)

}


class Pencil {
    
private:
    vector<element> vertices; // 多边形顶点
    vector<element> points;   // 多边形所有点
    int num_vertices;         // 多边形顶点数量
    int num_points;           // 多边形所有点数量
    float avg_pressure;       // 平均压力
    float pencil_degree;      // 铅笔硬度
    float da();               // 返回值域[0, 1]

    calAllpoints();           // 广搜算法算出所有点
    calCoefficient();         // 全局插值法求所有点压力系数
    calPressures();           // 计算各点承受的压力
    calAvgPressures();        // 计算所有点的平均压力

    const int GRAPHITE_PERCENT;
    const int CLAY_PERCENT;
    const int WAX_PERCENT;

public:
    Pencil();                 // 中心及边界坐标和对应压力系数，调用以下四个函数
                              // calAllpoints(); calCoefficient(); 
                              // calPressures(); calAvgPressures();     
}

/* *********** Oringinal Begin *******************/
class Grain {

private:
    float h_k;    // 高度
    float hs_k;   // 高度的补
    float hs_min;
    float hs_max;
    float v_g;    // 突起体积
    int t_v;      // 突起最大笔屑容量
    float d_k;    // D_k, 各高度比率
    int l_k;      // 各高度的最大笔屑容量
    float b_v;    // 纸张突起的体积损耗
    int b_k;      // 各高度接到的笔屑
    int t_k;      // 实际接收的笔屑数量
    float G_k;  
    float C_k;
    float W_k;

public:
    Grain();      // 初始化各参数
    
    calHs_k();             // 计算突起补的体积
    calT_v();              // 计算突起最大笔屑容量
    calL_k();              // 计算各高度的最大笔屑容量

    calB_v();     // 计算突起损耗B_v
    adjustB_v();  // 调整B_v
    updateH_k(Pd，纸的厚度);  // 更新突起高度
    calB_k();     // 计算各高度上接到的笔屑
    calT_k(Pencil的三个const常量);  // 计算实际接收的笔屑数量，同时调用上面4个函数操作
}


class Paper {

private:
    vector<vector<Grain>>; // 存放突起的二维数组
    const int f_v;         // 常量属性，值域范围[1000, 3000]
    const float W;         // 纸张重量，值域范围[0, 1]
    const float M;         // 常量，值域范围[0.97, 0.99]
    
public:
    Paper();               // 根据输入参数初始化纸张及各个高度
                           // （利用分形算法求出各个高度）

    calGrain(int x, int y, 传进纸的信息); // 计算纸张受影响部分接收的笔屑,通过调用calB_k(),calT_k()
    
}
/* *********** Oringinal End *******************/

/* *********** Modified Begin *******************/
class Grain {

private:
    float h;      // 高度
    float h_min;
    float h_max;
    float hp;     // 高度的补
    float hp_min;
    float hp_max;

    float d_k;    // D_k, 各高度比率
    float v_g;    // 突起体积
    float t_v;    // 突起最大笔屑容量
    float l_k;    // 各高度的最大笔屑容量

    Grain* minor_right;     // 表示该高度所持有的另外三个副高度
    Grain* minor_bottom;
    Grain* minor_rightBottom;

    Grain* major_right;     // 表示该突起高度所相关的另外三个突起主高度
    Grain* major_bottom;
    Grain* major_rightBottom;

   float getH()      { return h; }
   float getHp()     { return hp; }
/* float getH_sum();
   float getHp_sum();*/
   float calL_k(float gh); // 计算某高度分属各个突起所能容纳的最大笔屑数量
   void update(float f_v); // 更新突起所有其他有关属性以及相关突起高度的属性

public:
    Grain();
    void init(Grain* ir, Grain* ib, Grain* irb,   // i前缀表示副高度，a前缀表示主高度
              Grain* ar, Grain* ab, Grain* arb);  // 在使用Grain前必须初始化Grian左，下，左下三个方向的突起高度
    void update(float newH, float f_v);           // 更新突起主高度

    float getH_max()  { return h_max; }
    float getH_min()  { return h_min; }
    float getHp_max() { return hp_max; }
    float getHp_min() { return hp_min; }

    float getD_k()    { return d_k; }    
    float getT_v()    { return t_v; }    
    float getL_k()    { return l_k; }    
};


class Paper {

private:
    vector<vector<Grain> > grains;// 存放突起的二维数组
    const float f_v;              // 常量属性，值域范围[1000, 3000]
    const float W;                // 纸张重量，值域范围[0, 1]
    const float M;                // 常量，值域范围[0.97, 0.99]
    
    void init();                  // 将各突起高低构造为图结构
public:
    Paper(/* param */);                         // 根据输入参数初始化纸张及各个高度
    Grain& getGrain(int x, int y);              // 获取突起
    void updateGrain(float newH, int x, int y); // 更具交互结果更新相应突起
};
/* *********** Modified End *******************/


class Interaction {

private:
    float d_l;             // 铅笔距离纸平面的高度
    int e_k;               // 纸张损耗的总重量
    Paper paper;
    Pencil pencil;
    ba();                  // 返回值域[0, 1]
    
public:
    Interaction();
    calD_l();              // 计算铅笔距纸平面高度
    calE_k();              // 计算纸张损耗的总重量
    calGray(int x, int y); // 通过xy计算灰度值，调用铅笔的calAllPoints()函数得到所影响的点，传给Paper的calGrain()进行运算
    updateAllGrains(pencil, d_l); // 通过传进铅笔的硬度和铅笔距离纸的高度更新突起的高度,调用Grain的updateH_k()函数
    calPencilB_v(pencil);  // 调用calB_v()和adjustB_v()函数
     
}
    
class show {

private:
    Interation interation;
    
public:
    showGray(); // 通过interation的calGray()函数得到的灰度值进行显示

}
```
